// Module included in the following assembly:
//
// * release-notes/monitoring-release-notes.adoc

:_mod-docs-content-type: REFERENCE
[id="monitoring-4-15-release-notes_{context}"]
= {ocp} {product-version} monitoring release notes

[role="_abstract"]
The changes for {ocp} {product-version} monitoring are included in the following errata advisory:

* link:https://access.redhat.com/errata/RHSA-2023:7198[RHSA-2023:7198]

[id="monitoring-4-15-updates-to-monitoring-components-and-dependencies_{context}"]
== Updates to monitoring stack components and dependencies

This release includes the following version updates for in-cluster monitoring stack components and dependencies:

* Alertmanager to 0.26.0
* kube-state-metrics to 2.10.1
* node-exporter to 1.7.0
* Prometheus to 2.48.0
* Prometheus Adapter to 0.11.2
* Prometheus Operator to 0.70.0
* Thanos Querier to 0.32.5

[id="monitoring-4-15-changes-alerting-rules_{context}"]
== Changes to alerting rules

[NOTE]
====
Red{nbsp}Hat does not guarantee backward compatibility for recording rules or alerting rules.
====

* The `NodeClockNotSynchronising` and `NodeClockSkewDetected` alerting rules are now disabled when the Precision Time Protocol (PTP) is in use.

[id="monitoring-4-15-new-features-and-enhancements_{context}"]
== New features and enhancements

The in-cluster monitoring stack for this release includes the following new features and enhancements:

New feature to send exemplar data to remote write storage for user-defined projects::
User-defined projects can now use remote write to send exemplar data scraped by Prometheus to remote storage.
To use this feature, configure remote write using the `sendExemplars` option in the `RemoteWriteSpec` resource.
For more information, see link:https://docs.redhat.com/en/documentation/monitoring_stack_for_red_hat_openshift/4.15/html-single/config_map_reference_for_the_cluster_monitoring_operator/index#remotewritespec[RemoteWriteSpec] in the config map API reference for the {cmo-full}.

Improved alert querying for user-defined projects::
Applications in user-defined projects now have API access to query alerts for application namespaces via the rules tenancy port for Thanos Querier.
You can now construct queries that access the `/api/v1/alerts` endpoint via port 9093 for Thanos Querier, provided that the HTTP request contains a `namespace` parameter.
In previous releases, the rules tenancy port for Thanos Querier did not provide API access to the `/api/v1/alerts` endpoint.

Prometheus updated to tolerate jitters at scrape time::
The default Prometheus configuration in the monitoring stack has been updated so that jitters are tolerated at scrape time.
For monitoring deployments that have shown sub-optimal chunk compression for data storage, this update helps to optimize data compression, thereby reducing the disk space used by the time series database in these deployments.

Improved staleness handling for the kubelet service monitor::
Staleness handling for the kubelet service monitor has been improved to ensure that alerts and time aggregations are accurate.
This improved functionality is active by default and makes the dedicated service monitors feature obsolete.
As a result, the dedicated service monitors feature has been disabled and is now deprecated, and setting the `DedicatedServiceMonitors` resource to `enabled` has no effect.

Improved ability to troubleshoot reports of tasks failing::
The reasons provided when tasks fail in monitoring components are now more granular so that you can more easily pinpoint whether a reported failure originated in components deployed in the `openshift-monitoring` namespace or in the `openshift-user-workload-monitoring` namespace.
If the {cmo-first} reports task failures, the following reasons have been added to identify where the failures originated:
+
* The `PlatformTasksFailed` reason indicates failures that originated in the `openshift-monitoring` namespace.
* The `UserWorkloadTasksFailed` reason indicates failures that originated in the `openshift-user-workload-monitoring` namespace.

[id="monitoring-4-15-technology-preview-features_{context}"]
== Technology Preview features

[IMPORTANT]
====
[subs="attributes+"]
Technology Preview features are not supported with Red{nbsp}Hat production service level agreements (SLAs) and might not be functionally complete. Red{nbsp}Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red{nbsp}Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====

The following table tracks features that are in Technology Preview or were Technology Preview in recent releases. Features are marked with the following statuses:

* _Not Available_
* _Technology Preview_
* _General Availability_

.Monitoring Technology Preview tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.13 |4.14 |4.15

|Alerting rules based on platform monitoring metrics
|Technology Preview
|General Availability
|General Availability

|Metrics Collection Profiles
|Technology Preview
|Technology Preview
|Technology Preview

|Metrics Server
|Not Available
|Not Available
|Technology Preview

|====

The in-cluster monitoring stack for this release includes the following Technology Preview features:

New Metrics Server component to access the Metrics API (Technology Preview)::
This release introduces a Technology Preview option to add a Metrics Server component to the in-cluster monitoring stack.
As a Technology Preview feature, Metrics Server is automatically installed instead of Prometheus Adapter if the `FeatureGate` custom resource is configured with the `TechPreviewNoUpgrade` option.
If installed, Metrics Server collects resource metrics and exposes them in the `metrics.k8s.io` Metrics API service for use by other tools and APIs.
Using Metrics Server instead of Prometheus Adapter frees the core platform Prometheus stack from handling this functionality.
For more information, see link:https://docs.redhat.com/en/documentation/monitoring_stack_for_red_hat_openshift/4.15/html-single/config_map_reference_for_the_cluster_monitoring_operator/index#metricsserverconfig[MetricsServerConfig] in the config map API reference for the {cmo-full} and link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.15/html-single/nodes/index#nodes-cluster-enabling[Enabling features using feature gates].

[id="monitoring-4-15-deprecated-features_{context}"]
== Deprecated features

The following features in the in-cluster monitoring stack are deprecated in this release:

Dedicated service monitors for core platform monitoring::
With this release, the dedicated service monitors feature for core platform monitoring is deprecated.
The ability to enable dedicated service monitors by configuring the `dedicatedServiceMonitors` setting in the `cluster-monitoring-config` config map object in the `openshift-monitoring` namespace will be removed in a future {product-title} release.
To replace this feature, Prometheus functionality has been improved to ensure that alerts and time aggregations are accurate.
This improved functionality is active by default and makes the dedicated service monitors feature obsolete.

Prometheus Adapter for core platform monitoring::
With this release, the Prometheus Adapter component for core platform monitoring is deprecated and is planned to be removed in a future release.
Red{nbsp}Hat will provide bug fixes and support for this component during the current release lifecycle, but this component will no longer receive enhancements and will be removed.
As a replacement, a new Metrics Server component has been added to the monitoring stack.
Metrics Server is a simpler and more lightweight solution because it does not rely on Prometheus for its functionality.
Metrics Server also ensures scalability and a more accurate tracking of resource metrics.
With this release, the improved functionality of Metrics Server is available by default if you enable the `TechPreviewNoUpgrade` option in the `FeatureGate` custom resource.

[id="monitoring-4-15-deprecated-and-removed-tracker_{context}"]
== Deprecated and removed feature tracker

The following table tracks features that are deprecated or removed in recent releases. Features are marked with the following statuses:

* _General Availability_
* _Deprecated_
* _Removed_

.Monitoring deprecated and removed feature tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.13 |4.14 |4.15

|`dedicatedServiceMonitors` setting that enables dedicated service monitors for core platform monitoring
|General Availability
|General Availability
|Deprecated

|`prometheus-adapter` component that queries resource metrics from Prometheus and exposes them in the metrics API.
|General Availability
|General Availability
|Deprecated

|====

[id="monitoring-4-15-fixed-issues_{context}"]
== Fixed issues

The in-cluster monitoring stack for this release includes the following fixed issues:

* Previously, the monitoring-plugin component did not start if IPv6 was disabled for a cluster. This release updates the component to support the following internet protocol configurations in a cluster: IPv4 only, IPv6 only, and both IPv4 and IPv6 simultaneously. This change resolves the issue, and the monitoring-plugin component now starts up if the cluster is configured to support only IPv6. (link:https://issues.redhat.com/browse/OCPBUGS-21610[OCPBUGS-21610])

* Previously, instances of Alertmanager for core platform monitoring and for user-defined projects could inadvertently become peered during an upgrade. This issue could occur when multiple Alertmanager instances were deployed in the same cluster. This release fixes the issue by adding a `--cluster.label` flag to Alertmanager that helps to block any traffic that is not intended for the cluster. (link:https://issues.redhat.com/browse/OCPBUGS-18707[OCPBUGS-18707])

* Previously, it was not possible to use text-only email templates in an Alertmanager configuration to send text-only email alerts. With this update, you can configure Alertmanager to send text-only email alerts by setting the `html` field of the email receiver to an empty string. (link:https://issues.redhat.com/browse/OCPBUGS-11713[OCPBUGS-11713])

* Previously, Thanos Querier was unable to query pod metrics because the supporting `kube-rbac-proxy` instance disallowed `metrics.k8s.io/v1beta1/pods`. With this update, the `kube-rbac-proxy` configuration for Thanos Querier is fixed and you can now successfully query pod metrics. (link:https://issues.redhat.com/browse/OCPBUGS-17035[OCPBUGS-17035])