// Module included in the following assembly:
//
// * release-notes/monitoring-release-notes.adoc

:_mod-docs-content-type: REFERENCE
[id="monitoring-4-18-release-notes_{context}"]
= {ocp} {product-version} monitoring release notes

The changes for {ocp} {product-version} monitoring are included in the following errata advisory:

* link:https://access.redhat.com/errata/RHSA-2024:6122[RHSA-2024:6122]

[id="monitoring-4-18-updates-to-monitoring-components-and-dependencies_{context}"]
== Updates to monitoring stack components and dependencies

This release includes the following version updates for in-cluster monitoring stack components and dependencies:

* Metrics Server to 0.7.2
* Prometheus to 2.55.1
* Prometheus Operator to 0.78.1
* Thanos to 0.36.1

[id="monitoring-4-18-new-features-and-enhancements_{context}"]
== New features and enhancements

The in-cluster monitoring stack for this release includes the following new features and enhancements:

Added scrape and evaluation intervals for user workload monitoring Prometheus::
With this update, you can configure the intervals between consecutive scrapes and between rule evaluations for Prometheus for user workload monitoring.

Added early validation for the monitoring configurations in monitoring config maps::
This update introduces early validation for changes to monitoring configurations in `cluster-monitoring-config` and `user-workload-monitoring-config` config maps to provide shorter feedback loops and enhance user experience.

Added the proxy environment variables to Alertmanager containers::
With this update, Alertmanager uses the proxy environment variables. Therefore, if you configured an HTTP cluster-wide proxy, you can enable proxying by setting the `proxy_from_environment` parameter to `true` in your alert receivers or at the global config level in Alertmanager.

Added cross-project user workload alerting and recording rules::
With this update, you can create user workload alerting and recording rules that query multiple projects at the same time.

[id="monitoring-4-18-technology-preview-features_{context}"]
== Technology Preview features

[IMPORTANT]
====
[subs="attributes+"]
Technology Preview features are not supported with Red{nbsp}Hat production service level agreements (SLAs) and might not be functionally complete. Red{nbsp}Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red{nbsp}Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====

The following table tracks features that are in Technology Preview or were Technology Preview in recent releases. Features are marked with the following statuses:

* _Not Available_
* _Technology Preview_
* _General Availability_

.Monitoring Technology Preview tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.16 |4.17 |4.18

|Metrics Collection Profiles
|Technology Preview
|Technology Preview
|Technology Preview

|====

[id="monitoring-4-18-fixed-issues_{context}"]
== Fixed issues

The in-cluster monitoring stack for this release includes the following fixed issues:

* Previously, if the SMTP `smarthost` or `from` fields under the `emailConfigs` object were not specified at the global or receiver level in the `AlertmanagerConfig` custom resource (CR), Alertmanager would crash because these fields are required. With this release, the Prometheus Operator fails reconciliation if these fields are not specified. Therefore, the Prometheus Operator no longer pushes invalid configurations to Alertmanager, preventing it from crashing. (link:https://issues.redhat.com/browse/OCPBUGS-48050[OCPBUGS-48050])

* Previously, the {cmo-first} did not mark configurations in `cluster-monitoring-config` and `user-workload-monitoring-config` config maps as invalid for unknown (for example,  no longer supported) or duplicated fields. With this release, stricter validation is added that helps identify such errors. (link:https://issues.redhat.com/browse/OCPBUGS-42671[OCPBUGS-42671])

* Previously, it was not possible for a user to query the user workload monitoring Thanos API endpoint with `POST` requests. With this update, a cluster admin can bind a new `pod-metrics-reader` cluster role with a role binding or cluster role binding to allow `POST` queries for a user or service account. (link:https://issues.redhat.com/browse/OCPBUGS-41158[OCPBUGS-41158])

* Previously, an invalid config map configuration for core platform monitoring, user workload monitoring, or both caused {cmo-first} to report an `InvalidConfiguration` error. With this release, if only the user workload monitoring configuration is invalid, {cmo-short} reports `UserWorkloadInvalidConfiguration`, making it clear where the issue is located. (link:https://issues.redhat.com/browse/OCPBUGS-33863[OCPBUGS-33863])

* Previously, `telemeter-client containers` showed a `TelemeterClientFailures Warnings` message in multiple clusters. With this release, a runbook is added for the `TelemeterClientFailures` alert to explain the cause of the alert triggering and the alert provides resolution steps. (link:https://issues.redhat.com/browse/OCPBUGS-33285[OCPBUGS-33285])

* Previously, `AlertmanagerConfig` objects with invalid child routes generated invalid Alertmanager configuration leading to Alertmanager disruption. With this release, Prometheus Operator rejects such `AlertmanagerConfig` objects, and users receive a warning about the invalid child routes in logs. (link:https://issues.redhat.com/browse/OCPBUGS-30122[OCPBUGS-30122])

* Previously, the `config-reloader` for Prometheus for user-defined projects would fail if unset environment variables were used in the `ServiceMonitor` configuration, which resulted in Prometheus pods failing. With this release, the reloader no longer fails when an unset environment variable is encountered. Instead, unset environment variables are left as they are, while set environment variables are expanded as usual. Any expansion errors, suppressed or otherwise, can be tracked through the `reloader_config_environment_variable_expansion_errors` variable. (link:https://issues.redhat.com/browse/OCPBUGS-23252[OCPBUGS-23252])