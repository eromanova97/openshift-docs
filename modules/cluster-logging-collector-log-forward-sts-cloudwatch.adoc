// Module included in the following assemblies:
//
// * configuring/configuring-log-forwarding.adoc

//https://github.com/openshift/cluster-logging-operator/blob/master/docs/features/logforwarding/outputs/cloudwatch-sts-forwarding.adoc

:_mod-docs-content-type: PROCEDURE
[id="cluster-logging-collector-log-forward-sts-cloudwatch_{context}"]
= Forwarding logs to Amazon CloudWatch from STS-enabled clusters

You can forward logs from {logging-title} deployed on clusters with {aws-first} {sts-first}-enabled to Amazon CloudWatch. Amazon CloudWatch is a service that helps administrators observe and monitor resources and applications on {aws-short}.

.Prerequisites

* {clo} has been installed.
* You have configured a credential secret.
* You have administrator access to {product-title}.

.Procedure

* Create or update a `ClusterLogForwarder` custom resource (CR):
+
[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: <log_forwarder_name>
  namespace: openshift-logging
spec:
  serviceAccount:
    name: <service_account_name> #<1>
  outputs:
   - name: cw-output #<2>
     type: cloudwatch #<3>
     cloudwatch:
       groupName: 'cw-projected{.log_type||"missing"}' #<4>
       region: us-east-2 #<5>
       authentication:
         type: iamRole #<6>
         iamRole:
           roleARN: #<7>
             key: role_arn 
             secretName: sts-secret
           token: #<8>
             from: serviceAccount  
  pipelines:
    - name: to-cloudwatch
      inputRefs: #<9>
        - infrastructure
        - audit
        - application
      outputRefs: #<10>
        - cw-output
----
<1> Specify the service account.
<2> Specify a name for the output.
<3> Specify the `cloudwatch` type.
<4> Specify the group name for the log stream.
<5> Specify the AWS region.
<6> Specify `iamRole` as the authentication type for STS.
<7> Specify the name of the secret and the key where the `role_arn` resource is stored.
<8> Specify the service account token to use for authentication. To use the projected service account token, use `from: serviceAccount`.
<9> Specify which log types to forward by using the pipeline: `application,` `infrastructure`, or `audit`.
<10> Specify the names of the output to use when forwarding logs with this pipeline.
