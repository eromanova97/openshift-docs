// Module included in the following assemblies:
//
// * observability/logging/performance_reliability/logging-content-filtering.adoc
// * configuring/configuring-log-forwarding.adoc

:_mod-docs-content-type: PROCEDURE
[id="logging-content-filter-prune-records_{context}"]
= Configuring content filters to prune log records

If you configure the `prune` filter, the log collector evaluates log streams against the filters before forwarding. The collector prunes log records by removing low value fields such as pod annotations.

.Prerequisites

* You have installed the {clo}.
* You have administrator permissions.
* You have created a `ClusterLogForwarder` custom resource (CR).
* You have installed the {oc-first}.

.Procedure

. Extract the existing `ClusterLogForwarder` configuration and save it as a local file.
+
[source,terminal]
----
$ oc get clusterlogforwarder <name> -n <namespace> -o yaml > <filename>.yaml
----
+
Where:
+
* `<name>` is the name of the `ClusterLogForwarder` instance you want to configure.
* `<namespace>` is the namespace where you created the `ClusterLogForwarder` instance, for example `openshift-logging`.
* `<filename>` is the name of the local file where you save the configuration.

. Add a configuration to prune log records to the `filters` spec in the `ClusterLogForwarder` CR.
+
[IMPORTANT]
====
If you specify both `in` and `notIn` parameters, the `notIn` array takes precedence over `in` during pruning. After records are pruned by using the `notIn` array, they are then pruned by using the `in` array.
====
+
.Example `ClusterLogForwarder` CR
[source,yaml]
----
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  serviceAccount:
    name: my-account
  filters:
  - name: prune-filter
    type: prune # <1>
    prune: # <2>
      in: [.kubernetes.annotations, .kubernetes.namespace_id] # <3>
      notIn: [.kubernetes,.log_type,.message,."@timestamp",.log_source] # <4>
  pipelines:
  - name: my-pipeline # <5>
    filterRefs: ["prune-filter"]
  # ...
----
<1> Specify the type of filter. The `prune` filter prunes log records by configured fields.
<2>  Specify configuration options for the `prune` filter.
** The `in` and `notIn` fields are arrays of dot-delimited paths to fields in log records.
** Each path segment can contain alpha-numeric characters and underscores, `a-z`, `A-Z`, `0-9`, `_`, for example, `.kubernetes.namespace_name`.
** If segments contain different characters, the segment must be in quotes, for example, `.kubernetes.labels."app.version-1.2/beta"`.
<3> Optional: Specify fields to remove from the log record. The log collector keeps all other fields.
<4> Optional: Specify fields to keep in the log record. The log collector removes all other fields.
<5> Specify the pipeline that the `prune` filter is applied to.
+
[IMPORTANT]
====
* The filters cannot remove the `.log_type`, `.log_source`, `.message` fields from the log records. You must include them in the `notIn` field.

* If you use the `googleCloudLogging` output, you must include `.hostname` in the `notIn` field.
====

. Apply the `ClusterLogForwarder` CR by running the following command:
+
[source,terminal]
----
$ oc apply -f <filename>.yaml
----
