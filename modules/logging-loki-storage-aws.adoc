// Module is included in the following assemblies:
//
// * configuring/configuring-the-log-store.adoc

:_mod-docs-content-type: PROCEDURE
[id="logging-loki-storage-aws_{context}"]
= AWS storage

You can create an object storage in {aws-first} to store logs. 

.Prerequisites

* You installed the {loki-op}.
* You installed the {oc-first}.
* You created a link:https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html[bucket] on AWS.
* You created an link:https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#policies_resource-based[AWS IAM Policy and IAM User].

.Procedure

* Create an object storage secret with the name `logging-loki-aws` by running the following command:
+
[source,terminal,subs="+quotes"]
----
$ oc create secret generic logging-loki-aws \ #<1>
  --from-literal=bucketnames="<bucket_name>" \
  --from-literal=endpoint="<aws_bucket_endpoint>" \
  --from-literal=access_key_id="<aws_access_key_id>" \
  --from-literal=access_key_secret="<aws_access_key_secret>" \
  --from-literal=region="<aws_region_of_your_bucket>"
  --from-literal=forcepathstyle="true" # <2>
----
<1> `logging-loki-aws` is the name of the secret.
<2> {aws-short} endpoints (those ending in `.amazonaws.com`) use a virtual-hosted style by default, which is equivalent to setting the `forcepathstyle` attribute to `false`. Conversely, non-AWS endpoints use a path style, equivalent to setting  `forcepathstyle` attribute to `true`. If you need to use a virtual-hosted style with non-AWS S3 services, you must explicitly set `forcepathstyle` to `false`.

[id="AWS_storage_STS_{context}"]
== AWS storage for STS enabled clusters

If your cluster has STS enabled, the Cloud Credential Operator (CCO) supports short-term authentication by using AWS tokens.

You can create the Loki object storage secret manually by running the following command:
[source,terminal,subs="+quotes"]
----
$ oc -n openshift-logging create secret generic "logging-loki-aws" \
  --from-literal=bucketnames="<s3_bucket_name>" \
  --from-literal=region="<bucket_region>" \
  --from-literal=audience="<oidc_audience>" <1>
----
<1> Optional annotation, default value is `openshift`.
